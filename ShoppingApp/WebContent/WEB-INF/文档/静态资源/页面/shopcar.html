<!DOCTYPE html>
<html lang="zh_CN">
<head>
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>购物车</title>
<!-- Bootstrap core CSS -->
<link href="resources/bootstrap/css/bootstrap.css" rel="stylesheet" />

<link href="resources/css/taobao.css" rel="stylesheet" />
<script src="resources/jquery/jquery-1.11.0.min.js"></script>
<script src="resources/jquery/jquery-migrate-1.2.1.min.js"></script>
<script src="resources/bootstrap/js/bootstrap.js"></script>
<script src="resources/js/taobao.js"></script>
<script type="text/javascript">
	$(function() {
		// 全部的单选 
		boxs = $("input[type='checkBox'][id^='box_']");

		//全选事件 
		$("#checkAll").click(function() {
			boxs.attr("checked", this.checked);

			updateSureNum();
		});

		// 给每个单选按钮绑定一个点击数事件 
		boxs.click(function() {
			// 获取当前选中的所有按钮 
			var checkedBoxs = boxs.filter(":checked");
			// 判断选中的按钮是否等于总的按钮数 等于 全选也应该被选中反之 
			$("#checkAll").attr("checked", boxs.length == checkedBoxs.length);

			updateSureNum();
		});

		// 提交订单绑定点击事件 
		$("#commitOrder").click(function() {
			// 获取当前选中的商品的id 去下订单 
			var checkedBoxs = boxs.filter(":checked");
			if (checkedBoxs.length > 0) {
				// 获取这些单选按钮的value属性即是选中商品的id 
				/*  checkedBoxs.each(function(){
				  alert(this.value);
				 }) */
				var maps = checkedBoxs.map(function() {
					return this.value;
				});

				var ids = maps.get();
				// 提交到后台进行订单的提交动作 
				window.location = "shop/order/addOrder.action?ids=" + ids + "";
			} else {
				alert("请选择需要购买的商品");
			}

		})
	})

	function updateSureNum() {

		var checkedBoxs = boxs.filter(":checked");

		$(".badge").html(checkedBoxs.length);

		var totalMoney = 0.0;

		// 计算总价 
		checkedBoxs.each(function() {
			var id = this.id;
			// 获取存放此商品总价的那个id  
			var totalId = id.replace("box_", "total_");
			// 取此商品的总价 
			var money = $("#" + totalId).text();

			totalMoney += parseFloat(money); // totalMoney = totalMoney + parseFloat(money)
		});

		$("#totalMoney").html(totalMoney + "元");
	}
</script>

</head>
<body>
	<!-- 横幅导航条开始 -->
	<nav class="navbar navbar-fixed-top navbar-inverse" role="navigation">
		<div class="container">
			<div class="navbar-header">
				<button type="button" class="navbar-toggle collapsed"
					data-toggle="collapse" data-target="#navbar" aria-expanded="false"
					aria-controls="navbar">
					<span class="sr-only">显示导航条</span> <span class="icon-bar"></span> <span
						class="icon-bar"></span> <span class="icon-bar"></span>
				</button>
				<a class="navbar-brand" href="shop/index.action">疯狂购物</a>
			</div>
			<div id="navbar" class="collapse navbar-collapse">
				<ul class="nav navbar-nav">
					<li class="active"><a href="shop/index.action">首页</a></li>
					<li><a href="shop/shopCar.action">购物车</a></li>
					<li><a href="shop/order/showOrder.action">我的订单</a></li>
				</ul>

				<ul class="nav navbar-nav navbar-right">
					<li><a href="#"> <span style='color: red;'></span>


					</a></li>

					<li><a href="identity/login-page.action">登录</a></li>
					<li><a href="identity/showRegister.action">免费注册</a></li>



				</ul>
			</div>
		</div>
	</nav>
	<!-- /.navbar -->
	<!--  横幅下方的主体开始 -->
	<div class="container">
		<div class="row row-offcanvas row-offcanvas-right">

			<!-- 内容主体开始 -->
			<div class="col-xs-12 col-sm-12">
				<div>当前位置：我的购物车</div>
				<div class="table-responsive">
					<table class="table table-hover table-bordered table-striped">
						<thead>
							<tr>
								<th><input type="checkbox" id="checkAll"></th>
								<th style="width: 15%">图片</th>
								<th style="width: 50%">名称</th>
								<th style="width: 10%">价格</th>
								<th style="width: 10%">数量</th>
								<th style="width: 8%">小计</th>
								<th style="width: 7%">操作</th>
							</tr>
						</thead>
						<tbody>
							<tr>
								<td style="vertical-align: middle;"><input type="checkbox"
									value="1" name="box" id="box_1" /> <span id="total_1"
									style="display: none;">4899.00</span></td>
								<td><img alt="商品图片"
									src="resources/images/article/20130401_1_0001_1.jpg"></td>
								<td>苹果（APPLE）iPhone 5 16G版 3G手机（白色）WCDMA/GSM
									全新设计，更薄、更轻、更快、更好的iPhone，以及卓越音效的EarPods耳机</td>
								<td><span class="price">4899.0</span></td>
								<td><span class="glyphicon glyphicon-minus" onclick=""></span>
									<input id="number_1" value="1"
									style="width: 40px; text-align: center;"
									onkeydown="return checkInputNumber(event)"
									onchange="updateNumber(1, this.value, 100)" /> <span
									class="glyphicon glyphicon-plus"
									onclick="updateNumber(1, parseInt($('#number_1').val()) + 1, 100)"></span>
								</td>
								<td>4899.00</td>
								<td><a href="shop/delete.action?id=1"
									onclick="return confirm('确定要把\n  苹果（APPLE）iPhone 5 16G版 3G手机（白色）WCDMA/GSM 全新设计，更薄、更轻、更快、更好的iPhone，以及卓越音效的EarPods耳机  \n从购物车中删除吗？')">删除</a>
									<a>收藏</a></td>
							</tr>

							<script type="text/javascript">
								var checkInputNumber = function(event) {
									//判断按键是否为数字键、删除键，除此之外的按键全部忽略
									var keyCode = event.keyCode;
									if (keyCode >= 48 && keyCode <= 57) {
										return true;
									} else if (keyCode == 8) {
										return true;
									}
									//返回false的时候，按下的键不会产生输入的效果
									return false;
								};

								var updateNumber = function(id, number, storage) {
									if (number < 1) {
										return;
									} else if (number > storage) {
										return;
									}
									// 到服务器修改购买的数量，重定向到我的购物车
									document.location.href = "shop/updateNumber.action?id="
											+ id + "&number=" + number;

									//如果使用ajax，需要在成功以后修改小计、修改总计
									//如果失败，则要把输入框的值设置为未修改之前的值
								};
							</script>
						</tbody>
					</table>
				</div>
			</div>
			<!-- 内容主体结束 -->
		</div>
		<!--/row-->

		<div align="right">
			总金额:<span id="totalMoney" style="color: red;">0元</span>&nbsp;&nbsp;&nbsp;&nbsp;
			<button id="commitOrder" class="btn btn-danger" type="button">
				提交订单 <span class="badge">0</span>
			</button>
		</div>
		<hr>
		<footer>
			<p>&copy; 版权所有，欢迎借鉴</p>
		</footer>
	</div>
	<!--/.container-->
	<!--  横幅下方的主体结束 -->
</body>
</html>